<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="clecarouge_shop_products" inherit_id="website_sale.products" name="CleCarouge Shop Products" active="True">
    <xpath expr="//div[@id='wrap']" position="replace">
      <div t-cache="pricelist,products" t-if="products"
        class="cc_shop">

        <div class="categories">
          <button class="mobile-only" onclick="toggleCategoriesMobile();">
            <span>Filtrer et trier</span>
            <span id="cat-menu-closed">▾</span>
            <span id="cat-menu-open" class="hidden">▴</span>
          </button>
          <ul class="categories-list">
            <li t-foreach="categories" t-as="c">
              <a href="#" t-field="c.name" t-attf-onclick="openCategory(event, {{c.id}})"></a>
              <ul t-if="c.child_id" t-attf-class="sub-cat subcategories hidden s{{c.id}}">
                <t t-foreach="c.child_id" t-as="sc">
                  <t t-if="not search or sc.id in search_categories_ids">
                    <li>
                      <a t-if="not sc.child_id" t-att-href="keep('/shop/category/' + slug(sc), category=0)"
                        t-field="sc.name"></a>
                      <a t-if="sc.child_id" href="#" t-attf-onclick="openCategory(event, {{sc.id}})">
                        <span class="extend">
                          ▸
                        </span>
                        <t-field t-field="sc.name"></t-field>
                      </a>
                      <ul t-if="sc.child_id" t-attf-class="sub-cat inner-subcategory hidden s{{sc.id}}">
                        <t t-foreach="sc.child_id" t-as="ssc">
                          <t t-if="not search or ssc.id in search_categories_ids">
                            <li>
                              <a t-att-href="keep('/shop/category/' + slug(ssc), category=0)"
                                t-field="ssc.name"></a>
                            </li>
                          </t>
                        </t>
                      </ul>
                    </li>
                  </t>
                </t>
              </ul>
            </li>
          </ul>
        </div>

        <div class="shop-grid">
          <t t-foreach="bins" t-as="line">
            <t t-foreach="line" t-as="product">
              <a t-att-href="product['product'].website_url"
                t-attf-class="#{'unpublished' if not product['product'].website_published else ''} shop-item">
                <t t-set="image_holder" t-value="product['product']._get_image_holder()" />
                <span class="aspect" t-field="image_holder.image_1920"
                  t-options="{'widget': 'image', 'preview_image': 'image_1920' if product_image_big else 'image_1024', 'itemprop': 'image'}" />
                <div class="shop-item-description">
                  <p>
                    <span t-field="product['product'].name"></span>
                  </p>
                  <t t-set="combination_info"
                    t-value="product['product']._get_combination_info(only_template=True, add_qty=add_qty or 1, pricelist=pricelist)" />
                  <p>
                    <span t-esc="combination_info['price']" style="white-space: nowrap;"
                      t-options="{'widget': 'monetary','display_currency': website.currency_id}" />
                  </p>
                </div>
              </a>
            </t>
          </t>
        </div>

        <t t-call="website.pager" />
      </div>

      <div class="cc_search hidden">
        <t t-call="website.website_search_box_input">
          <t t-set="search_type" t-valuef="all" />
          <t t-set="action" t-valuef="/website/search" />
          <t t-set="limit" t-valuef="5" />
          <t t-set="display_image" t-valuef="true" />
          <t t-set="display_description" t-valuef="true" />
          <t t-set="display_extra_link" t-valuef="true" />
          <t t-set="display_detail" t-valuef="true" />
        </t>
        <div class="cc_shadow" onClick="closeSearch()"></div>
      </div>
    </xpath>
  </template>
</odoo>